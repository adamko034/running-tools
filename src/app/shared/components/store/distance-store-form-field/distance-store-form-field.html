<app-form-field [horizontalLineText]="'COMMON.DISTANCE' | translate">
  <!-- Modern Distance Input -->
  <div class="relative group w-48">
    <div
      class="flex items-center bg-white/80 backdrop-blur-sm rounded-xl border shadow-sm hover:shadow-md transition-all duration-200 focus-within:ring-2"
      [class]="isValid() ? 'border-slate-200/60 focus-within:ring-slate-300/50 focus-within:border-slate-300' : 'border-red-300 focus-within:ring-red-300/50 focus-within:border-red-400'"
    >
      <!-- Distance Input -->
      <div class="flex-1 relative">
        <input
          type="number"
          min="0"
          step="0.001"
          [ngModel]="distance().value"
          name="distance"
          (ngModelChange)="setDistance($event)"
          (input)="onInput($event)"
          selectOnFocus
          class="w-full px-3 py-2.5 pr-12 bg-transparent border-0 focus:outline-none focus:ring-0 text-base font-medium"
          [class]="isValid() ? 'text-slate-900 placeholder-slate-400' : 'text-red-700 placeholder-red-400'"
          placeholder="0.0"
        />

        <!-- Unit Display -->
        <div
          class="absolute right-3 top-1/2 -translate-y-1/2 text-sm font-medium"
          [class]="isValid() ? 'text-slate-500' : 'text-red-500'"
        >
          {{ distance().unit }}
        </div>
      </div>

      <!-- Preset Menu Button -->
      <div class="flex-shrink-0 border-l pl-3 pr-4"
           [class]="isValid() ? 'border-slate-200/60' : 'border-red-300'">
        <button
          [matMenuTriggerFor]="distanceMenu"
          [attr.aria-label]="'COMMON.DISTANCE_SELECT' | translate"
          class="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-50 rounded-lg transition-colors duration-200"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- Validation Error Message -->
    @if (!isValid() && errorMessage()) {
      <div class="mt-1 text-sm text-red-600 font-medium">
        {{ errorMessage() | translate }}
      </div>
    }

    <!-- Quick distance selectors -->
    <div class="flex gap-1 mt-2 justify-center">
      <button
        (click)="setRaceDistance(5)"
        class="px-2 py-1 text-xs text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded transition-colors duration-200"
        type="button"
      >
        5K
      </button>
      <button
        (click)="setRaceDistance(10)"
        class="px-2 py-1 text-xs text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded transition-colors duration-200"
        type="button"
      >
        10K
      </button>
      <button
        (click)="setRaceDistance(21.097)"
        class="px-2 py-1 text-xs text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded transition-colors duration-200"
        type="button"
      >
        {{ 'COMMON.DISTANCES.HALF_MARATHON_SHORT' | translate }}
      </button>
      <button
        (click)="setRaceDistance(42.195)"
        class="px-2 py-1 text-xs text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded transition-colors duration-200"
        type="button"
      >
        {{ 'COMMON.DISTANCES.MARATHON_SHORT' | translate }}
      </button>
    </div>
  </div>

  <mat-menu #distanceMenu="matMenu" class="mt-2">
    @for (distanceKey of distancesKeys; track $index) {
      <button
        mat-menu-item
        (click)="setRaceDistance(distances[distanceKey].distance.value)"
        class="text-slate-700 hover:bg-slate-50"
      >
        {{ distances[distanceKey].translationKey | translate }}
      </button>
    }
  </mat-menu>
</app-form-field>
