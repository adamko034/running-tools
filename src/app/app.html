<app-update-notification></app-update-notification>
<mat-sidenav-container class="h-screen">
  <!-- Sidenav for mobile -->
  <mat-sidenav #drawer mode="over" [opened]="false" class="py-3 px-4">
    <nav
      tabindex="0"
      (click)="drawer.close()"
      (keyup)="($event.key === 'Enter' || $event.key === ' ') && drawer.close()"
      role="button"
      aria-label="Close navigation"
    >
      <ng-container *ngTemplateOutlet="nav"></ng-container>
    </nav>
  </mat-sidenav>

  <mat-sidenav-content>
    <mat-toolbar *ngIf="isMobile" color="primary" class="flexs items-center">
      <button
        mat-icon-button
        (click)="drawer.toggle()"
        class="mt-[7px] mr-3 cursor-wpointer"
        aria-label="Toggle navigation"
      >
        <mat-icon>menu</mat-icon>
      </button>
    </mat-toolbar>

    <main
      class="min-height-screen flex w-full pb-6"
      [class.justify-center]="!isMobile"
    >
      <!-- Main content area -->
      <div
        *ngIf="(isHomePage$ | async) === false"
        class="flex-1 px-4 w-full max-w-4xl min-w-0"
        [class.mr-4]="!isMobile"
      >
        <router-outlet></router-outlet>
      </div>

      <div *ngIf="isHomePage$ | async" class="flex-1 px-4">
        <router-outlet></router-outlet>
      </div>

      <div
        *ngIf="(isHomePage$ | async) === false && !isMobile"
        class="w-px divider flex-shrink-0"
        role="separator"
        aria-label="Divider"
      ></div>

      <!-- Sidebar - only show when not on home page -->
      <aside
        *ngIf="(isHomePage$ | async) === false && !isMobile"
        class="w-70 flex-shrink-0 px-3"
      >
        <ng-container *ngTemplateOutlet="nav"></ng-container>
      </aside>
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>

<ng-template #nav>
  <!-- Logo/Brand -->
  <a
    routerLink="/"
    class="nav-brand flex justify-center items-center hover:bg-gray-50 no-underline text-inherit transition-all duration-200 ease-in-out rounded-xl px-3 py-2 mb-6"
  >
    <span class="font-semibold mr-2 text-xl text-gray-800">Runner</span>
    <img src="icons/icon-48x48.png" alt="Runner Toolkit" class="w-[40px]" />
    <span class="font-semibold text-xl text-gray-800">Toolkit</span>
  </a>

  <!-- Navigation Content -->
  <div class="nav-content overflow-y-auto">
    <nav class="nav-groups">
      @for (navGroup of navigation$ | async; track $index) {
        <div class="nav-group">
          <!-- Group Title -->
          <div class="nav-group-title">
            {{ navGroup.title }}
          </div>

          <!-- Group Links -->
          <div class="nav-links">
            @for (link of navGroup.links; track $index) {
              <a
                [routerLink]="link.link"
                routerLinkActive="nav-link-active"
                [routerLinkActiveOptions]="{ exact: true }"
                class="nav-link"
                [title]="link.description"
              >
                <mat-icon class="nav-link-icon">{{ link.icon }}</mat-icon>
                <span class="nav-link-text">{{ link.text }}</span>
              </a>
            }
          </div>
        </div>
      }
    </nav>

    <!-- Settings Section -->
    <div class="nav-settings">
      <div class="nav-group-title">Settings</div>
      <div class="settings-controls">
        <app-unit-store-selector />
        <!-- <app-language-store-selector /> -->
      </div>
    </div>

    <!-- Version Display -->
    <div class="nav-footer">
      <app-version-display />
    </div>
  </div>
</ng-template>
