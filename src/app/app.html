<!-- Top Navigation Bar -->
<header class="top-nav-bar">
  <!-- Brand/Logo -->
  <a routerLink="/" class="nav-brand-top">
    <img src="icons/icon-48x48.png" alt="Runner Toolkit" class="brand-icon" />
    <span class="brand-text">Runner Toolkit</span>
  </a>

  <!-- Main Navigation Categories -->
  <nav class="nav-categories" *ngIf="!isMobile">
    @for (navGroup of navigation$ | async; track $index) {
      <div 
        class="nav-category"
        [ngClass]="getCategoryClass(navGroup.title)"
        (mouseenter)="setActiveCategory(navGroup)"
        (mouseleave)="clearActiveCategory()"
      >
        <button 
          class="category-button"
          [class.active]="activeCategory === navGroup"
        >
          {{ navGroup.title }}
          <mat-icon class="category-icon">keyboard_arrow_down</mat-icon>
        </button>
        
        <!-- Dropdown Menu -->
        <div 
          class="category-dropdown"
          [class.show]="activeCategory === navGroup"
        >
          @for (link of navGroup.links; track $index) {
            <a 
              [routerLink]="link.link"
              class="dropdown-link"
              routerLinkActive="dropdown-link-active"
              [routerLinkActiveOptions]="{ exact: true }"
              [title]="link.description"
              (click)="clearActiveCategory()"
            >
              <mat-icon class="dropdown-icon">{{ link.icon }}</mat-icon>
              <span>{{ link.text }}</span>
            </a>
          }
        </div>
      </div>
    }
  </nav>

  <!-- Settings and Mobile Menu -->
  <div class="nav-actions">
    <app-unit-store-selector *ngIf="!isMobile" />
    
    <!-- Mobile menu button -->
    <button
      *ngIf="isMobile"
      mat-icon-button
      (click)="drawer.toggle()"
      class="mobile-menu-btn"
      aria-label="Toggle navigation"
    >
      <mat-icon>menu</mat-icon>
    </button>
  </div>
</header>

<!-- Mobile Drawer -->
<mat-sidenav-container class="mobile-nav-container" *ngIf="isMobile">
  <mat-sidenav #drawer mode="over" [opened]="false" class="mobile-drawer">
    <div class="mobile-nav-content">
      <ng-container *ngTemplateOutlet="mobileNav"></ng-container>
    </div>
  </mat-sidenav>
  
  <mat-sidenav-content>
    <!-- Main content -->
    <main class="main-content">
      <router-outlet></router-outlet>
    </main>
    <!-- Footer inside sidenav-content for mobile -->
    <app-footer></app-footer>
  </mat-sidenav-content>
</mat-sidenav-container>

<!-- Desktop content -->
<div *ngIf="!isMobile">
  <main class="main-content">
    <router-outlet></router-outlet>
  </main>
  <!-- Footer for desktop -->
  <app-footer></app-footer>
</div>

<!-- Cookie Consent Banner -->
<app-cookie-consent></app-cookie-consent>

<!-- Mobile Navigation Template -->
<ng-template #mobileNav>
  <!-- Fixed Header with Close Button -->
  <div class="mobile-nav-header">
    <button 
      mat-icon-button 
      (click)="drawer.close()"
      class="close-btn"
      aria-label="Close navigation"
    >
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Scrollable Navigation Groups -->
  <div class="mobile-nav-groups">
    @for (navGroup of navigation$ | async; track $index) {
      <div class="mobile-nav-section" [ngClass]="getCategoryClass(navGroup.title)">
        <!-- Category Header -->
        <div class="mobile-category-header">
          <div class="category-indicator"></div>
          <span class="category-title">{{ navGroup.title }}</span>
          <div class="category-count">{{ navGroup.links.length }}</div>
        </div>
        
        <!-- Category Links -->
        <div class="mobile-nav-links">
          @for (link of navGroup.links; track $index) {
            <a
              [routerLink]="link.link"
              class="mobile-nav-link"
              routerLinkActive="mobile-nav-link-active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="drawer.close()"
            >
              <div class="link-icon-wrapper">
                <mat-icon class="mobile-nav-icon">{{ link.icon }}</mat-icon>
              </div>
              <div class="link-content">
                <span class="link-title">{{ link.text }}</span>
                <span class="link-description">{{ link.description }}</span>
              </div>
              <mat-icon class="link-arrow">chevron_right</mat-icon>
            </a>
          }
        </div>
      </div>
    }
  </div>

  <!-- Fixed Footer with Settings -->
  <div class="mobile-nav-footer">
    <div class="mobile-settings-section">
      <div class="settings-header">
        <mat-icon class="settings-icon">settings</mat-icon>
        <span>Settings</span>
      </div>
      <div class="settings-content">
        <app-unit-store-selector />
      </div>
    </div>
  </div>
</ng-template>
